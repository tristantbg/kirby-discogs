(function () {function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){d(t,e,i[e])})}return t}function d(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function e(t){var o=new RegExp(/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/g);return!t||t.match(o)}function f(t,o){var r={youtube:/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,vimeo:/vimeo\.com\/([0-9]+)/,flickr:/^.*(flickr\.com)\/(.*)/,soundcloud:/^.*(soundcloud\.com|snd\.sc)\/(.*)/,twitter:/^.*(twitter\.com)\/(.*)/,instagram:/^.*(instagram\.com)\/(.*)/};return-1!=Object.keys(r).indexOf(o)&&t.match(r[o])}var a={extends:"k-text-field",data:function(){return{timeoutId:null,debounceDelay:300,options:[],media:Object,loading:!1}},props:{provider:String},created:function(){this.value&&this.value.media&&this.hasLength(this.value.media)&&(this.media=this.value.media)},computed:{hasMedia:function(){return this.hasLength(this.media)},syncFailed:function(){return""!=this.inputValue&&!this.hasMedia},inputValue:function(){return this.value&&this.value.input?this.value.input:""}},methods:{onInput:function(t){var e=this,i=t.target.value;clearTimeout(this.timeoutId),this.timeoutId=setTimeout(function(){if(!e.isValidInput(i))return e.emitInput(i),!1;e.startLoading(),e.$api.get("kirby-discogs/get-data",{search:i}).then(function(t){if("success"==t.status&&t.data){var n=JSON.parse(t.data);n=n.results.map(function(t){return c({},t,{text:"".concat(t.title," (").concat(t.year,")")})}),e.options=n,setTimeout(function(){this.$refs.autocomplete.search(i),this.stopLoading()}.bind(e),100)}}).catch(function(t){e.media={},e.emitInput(i)})},this.debounceDelay)},emitInput:function(t){this.$emit("input",{input:t,media:this.media}),this.$emit("setMedia",this.media)},select:function(t){console.log(t),this.media=t,this.emitInput(t.text)},clearMedia:function(){this.media={},this.emitInput("")},setMedia:function(t){this.media=t,this.stopLoading()},hasLength:function(t){return Object.keys(t).length},startLoading:function(){this.loading=!0},stopLoading:function(){this.loading=!1},isValidInput:function(t){return!0}}};if(typeof a==="function"){a=a.options}Object.assign(a,function(){var render=function(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("div",[_c("div",{staticClass:"k-field",attrs:{"data-type":"discogs"}},[_c("div",{staticClass:"k-discogs-infos"},[_c("k-autocomplete",{ref:"autocomplete",attrs:{"options":_vm.options},on:{"select":_vm.select}},[_c("input",{attrs:{"type":"text","placeholder":_vm.$t("discogs.placeholder"),"autocomplete":"off"},on:{"input":_vm.onInput}})]),_vm._v(" "),_c("div",{staticClass:"k-discogs-status"},[_vm.loading?_c("span",{staticClass:"k-discogs-status-loading"},[_c("span",{staticClass:"loader"})]):_vm.hasMedia?_c("span",{staticClass:"k-discogs-status-clear",on:{"click":_vm.clearMedia}},[_vm._v(_vm._s(_vm.$t("discogs.clear"))+" "),_c("span",{staticClass:"cross"})]):_vm._e()])],1)]),_vm._v(" "),_vm.hasMedia?_c("div",{staticClass:"preview"},[_c("div",{staticClass:"preview-content"},[_c("div",{staticClass:"preview-content"},[_c("img",{attrs:{"src":_vm.media.cover_image,"width":"100%"}})]),_vm._v(" "),_c("div",{staticClass:"preview-background"}),_vm._v(" "),_c("div",{staticClass:"preview-title"},[_c("div",[_vm._v(_vm._s(_vm.media.title))]),_vm._v(" "),_c("div",[_vm._v(_vm._s(_vm.media.year))])])])]):_vm._e()])};var staticRenderFns=[];return{render:render,staticRenderFns:staticRenderFns,_compiled:true,_scopeId:null,functional:undefined}}());var b={extends:"k-text-input",props:{provider:String,media:Object},mounted:function(){this.loadEmbedScripts()},methods:{onInput:function(t){var i=this;if(!this.isValidUrl(t))return this.media={},this.emitInput(t),!1;this.$emit("startLoading"),this.$api.get("kirby-discogs/get-data",{url:t}).then(function(e){"success"==e.status&&e.data?i.media=e.data:i.media={},i.emitInput(t)}).catch(function(e){i.media={},i.emitInput(t)})},emitInput:function(t){this.$emit("input",{input:t,media:this.media}),this.$emit("setMedia",this.media),this.loadEmbedScripts()},loadEmbedScripts:function(){if(window.twttr)window.twttr.widgets.load();else if(this.media&&Object.keys(this.media).length&&"twitter"==this.media.providerName.toLowerCase()){var t=document.createElement("script");t.src="https://platform.twitter.com/widgets.js",document.body.appendChild(t)}if(window.instgrm)window.instgrm.Embeds.process();else if(this.media&&Object.keys(this.media).length&&"instagram"==this.media.providerName.toLowerCase()){var i=document.createElement("script");i.src="https://www.instagram.com/discogs.js",document.body.appendChild(i)}},isValidUrl:function(t){return!!e(t)&&!(this.provider&&!f(t,this.provider))}}};if(typeof b==="function"){b=b.options}panel.plugin("tristantbg/discogs",{fields:{discogs:a},components:{"k-discogs-input":b}});})();